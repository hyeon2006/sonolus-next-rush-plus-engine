# Next Sekai Level Data Format

## Initialization

Handles common initialization logic for the engine. Must appear exactly once as the first entity in level data.

### Fields

* **revision (EngineRevision)**: Which version of engine logic to use. Defaults to BASE. Takes on one of the following values:
  * BASE = 0
  * SONOLUS_1_1_0 = 1
* **initialLife (int)**: The initial life value for the level. Defaults to 1000.

## #BPM_CHANGE

The standard bpm change archetype.

### Fields

* **#BEAT (float)**
* **#BPM (float)**

## #TIMESCALE_GROUP

Represents a timescale group and is referenced by notes and timescale changes.

### Fields

* **first (ref[#TIMESCALE_CHANGE])**: [Temporary] a reference to the first change

## #TIMESCALE_CHANGE

A timescale change event.

### Fields

* **#BEAT (float)**
* **#TIMESCALE (float)**
* **#TIMESCALE_SKIP (float)**
* **#TIMESCALE_GROUP (ref[#TIMESCALE_GROUP])**
* **#TIMESCALE_EASE (TimescaleEaseType)**:
  * NONE = 0
  * LINEAR = 1
* **next (ref[#TIMESCALE_CHANGE])**: [Temporary] a reference to the next change
* **hideNotes**: Whether to hide notes while this change is active.

## *Note

Comprised of many archetypes according to the following naming scheme:
[![][image1]](https://tabatkins.github.io/railroad-diagrams/generator.html#Diagram%28%0A%20%20%20%20Choice%28%0A%20%20%20%20%20%20%20%200%2C%0A%20%20%20%20%20%20%20%20Sequence%28%0A%20%20%20%20%20%20%20%20%20%20%20%20Choice%280%2C%20Skip%28%29%2C%20Terminal%28%22Fake%22%29%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20Choice%28%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%200%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Sequence%28%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Choice%280%2C%20Terminal%28%22Normal%22%29%2C%20Terminal%28%22Critical%22%29%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Choice%28%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%200%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Sequence%28%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Choice%280%2C%20Skip%28%29%2C%20Terminal%28%22Head%22%29%2C%20Terminal%28%22Tail%22%29%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Choice%28%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%200%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Terminal%28%22Tap%22%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Terminal%28%22Flick%22%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Terminal%28%22Trace%22%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Terminal%28%22TraceFlick%22%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Terminal%28%22Release%22%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Terminal%28%22Tick%22%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Terminal%28%22Damage%22%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Terminal%28%22Anchor%22%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%29%2C%0A%20%20%20%20%20%20%20%20%29%2C%0A%20%20%20%20%20%20%20%20Sequence%28%0A%20%20%20%20%20%20%20%20%20%20%20%20Terminal%28%22Transient%22%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20Terminal%28%22Hidden%22%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20Terminal%28%22Tick%22%29%2C%0A%20%20%20%20%20%20%20%20%29%2C%0A%20%20%20%20%29%2C%0A%20%20%20%20Terminal%28%22Note%22%29%2C%0A%29%0A)
[Transient] TransientHiddenTick is generated by the editor during export and should not be presented to charters.

### Fields

* **#BEAT (float)**
* **#TIMESCALE_GROUP (ref[#TIMESCALE_GROUP])**: The timescale group of the note.
* **lane (float)**: The lane for the center of the note, centered at 0. Typical values range from -5.5 to 5.5 since the edges of the stage are at lane -6 and 6 (a note with a lane of 6 would be centered on the stage edge).
* **size (float)**: The size in lanes of *half* the note. E.g. a note of size 1 would take up two lanes and have an extent of (lane - size) to (lane + size). Typically ranges from 0.5 to 6.
* **direction (Direction)**: The direction of the note, for flicks. Has no effect on other notes. Takes on one of the following values:
  * UP_OMNI = 0
  * UP_LEFT = 1
  * UP_RIGHT = 2
  * DOWN_OMNI = 3
  * DOWN_LEFT = 4
  * DOWN_RIGHT = 5
* **next (ref[Note])**: [Editor] A reference to the next note in the slide, if any.
* **activeHead (ref?[Note])**: An optional reference to the starting note of the active slide. Used by tail flicks for input handling.
* **isAttached (bool)**: Whether this note's **lane, size**, and effective **timescale** should be calculated from **attachHead** and **attachTail**.
* **connectorEase (EaseType)**: What kind of easing is used for the connector immediately following this note. Takes on one of the following values:
  * NONE = 0
  * LINEAR = 1
  * IN_QUAD = 2
  * OUT_QUAD = 3
  * IN_OUT_QUAD = 4
  * OUT_IN_QUAD = 5
* **isSeparator**: [Editor] Whether this note is a connector segment separator. Head notes, tail notes, the first note of a slide, and the last note of a slide are always implicitly separators regardless of the value of this field.
* **segmentKind (ConnectorKind)**: What kind of connector comes in the connector segment after this note, if any. Takes on one of the following values:
  * NONE = 0
  * ACTIVE_NORMAL = 1
  * ACTIVE_CRITICAL = 2
  * FAKE_ACTIVE_NORMAL = 51
  * FAKE_ACTIVE_CRITICAL = 52
  * GUIDE_NEUTRAL = 101
  * GUIDE_RED = 102
  * GUIDE_GREEN = 103
  * GUIDE_BLUE = 104
  * GUIDE_YELLOW = 105
  * GUIDE_PURPLE = 106
  * GUIDE_CYAN = 107
  * GUIDE_BLACK = 108
* **segmentAlpha**: The alpha this note is at for guide connectors.
* **segmentLayer**: The z-layer the guide connector should be drawn at. Takes on one of the following values:
  * TOP = 0
  * BOTTOM = 1
* **attachHead (ref?[Note])**: The optional head the note attaches to for its **lane**, **size**, and **effective timescale**.
* **attachTail (ref?[Note])**: The optional tail the note attaches to for its **lane**, **size**, and **effective timescale**.
* **effectKind (EffectKind)**: What kind of sound effect the note plays when hit. Takes on one of the following values:
  * DEFAULT = 0
  * NONE = 1
  * NORM_BASIC = 2
  * NORM_FLICK = 3
  * NORM_TRACE = 4
  * NORM_TICK = 5
  * CRIT_BASIC = 6
  * CRIT_FLICK = 7
  * CRIT_TRACE = 8
  * CRIT_TICK = 9
  * DAMAGE = 10

## Connector

[Transient] Computed from notes during export and should be ignored during import.
An active slide connector or guide.

## Fields

* **head (ref[Note])**: A reference to the previous (earlier beat) note this connector connects to. Used to calculate starting **beat**, **lane**, and **size**. Also used to obtain the **ease** type.
* **tail (ref[Note])**: A reference to the next (later beat) note this connector connects to. Used to calculate ending **beat**, **lane** and **size**
* **segmentHead (ref[Note])**: A reference to the previous separator note. Used to determine **kind** and **alpha**.
* **segmentTail (ref[Note])**: A reference to the next separator note. Used to determine **alpha**.
* **activeHead (ref?[Note])**: If this is part of an active slide, a reference to the start note of the slide. Used to determine when to start accepting input for an active slide.
* **activeTail (ref?[Note])**: If this is part of an active slide, a reference to the end note of the slide.

## SimLine

[Transient] Computed from notes during export and should be ignored during import.
A simultaneous note line.

## Fields

* **left (ref[Note])**: A reference to the left note this connects to.
* **right (ref[Note])**: A reference to the right note this connects to.

[image1]: img/note_rr_diagram.png
